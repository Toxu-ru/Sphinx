# для 3.1.1.
##################### POSTS ##################################################
source posts
{

	type					= mysql
	sql_host                                = localhost
	sql_user				= root
	sql_pass				=
	sql_db					= ins
	sql_port				= 3306	# optional, default is 3306

    sql_query_pre = SET NAMES utf8
    sql_query 				= \
		SELECT id, UNIX_TIMESTAMP(date_pub) AS date, user_id as user, content \
		FROM su_con_post

    sql_attr_uint           = user
    sql_attr_timestamp      = date
	sql_ranged_throttle = 0
}



source posts_delta : posts
{
    sql_query_pre   =
    sql_query_pre = SET NAMES utf8
    sql_query           = \
		SELECT id, UNIX_TIMESTAMP(date_pub) AS date, user_id as user, rating, content \
		FROM ins_con_post WHERE date_pub > date_sub(now(), interval 1 day)
}

index posts {
	source = posts
	path = c:/Sphinx/data/posts
	mlock			= 0
	morphology	= libstemmer_russian
	min_word_len = 2
	min_stemming_len = 5
	min_prefix_len	= 0
	min_infix_len		= 0
	html_strip				= 1

    charset_table = 0..9, A..Z->a..z, U+23, a..z, U+410..U+42F->U+430..U+44F, U+430..U+44F,U+C5->U+E5, \
            U+E5, U+C4->U+E4, U+E4, U+D6->U+F6, U+F6, U+16B, U+0c1->a, U+0c4->a, U+0c9->e, U+0cd->i, \
            U+0d3->o, U+0d4->o, U+0da->u, U+0dd->y, U+0e1->a, U+0e4->a, U+0e9->e, U+0ed->i, U+0f3->o, \
            U+0f4->o, U+0fa->u, U+0fd->y, U+104->U+105, U+105, U+106->U+107, U+10c->c, U+10d->c, \
            U+10e->d, U+10f->d, U+116->U+117, U+117, U+118->U+119, U+11a->e, U+11b->e, U+12E->U+12F, \
            U+12F, U+139->l, U+13a->l, U+13d->l, U+13e->l, U+141->U+142, U+142, U+143->U+144, \
            U+144,U+147->n, U+148->n, U+154->r, U+155->r, U+158->r, U+159->r, U+15A->U+15B, U+15B, \
            U+160->s, U+160->U+161, U+161->s, U+164->t, U+165->t, U+16A->U+16B, U+16B, U+16e->u, \
            U+16f->u, U+172->U+173, U+173, U+179->U+17A, U+17A, U+17B->U+17C, U+17C, U+17d->z, \
            U+17e->z, U+DC->U+FC, U+DF, U+FC, \
            U+0D1->U+0F1, U+0F1, \
            U+C7->U+E7, U+E7, U+C0->a, U+E0->a, U+C8->e, U+E8->e, U+CF->i, U+EF->i, U+D2->o, U+F2->o


	stopwords = /usr/local/etc/sphinx.stopwords
	wordforms = /usr/local/etc/sphinx.wordforms
	# http://www.utf8-chartable.de/
	ignore_chars = U+AD, U+5F 
}

# all the parameters are copied from the parent index,
# and may then be overridden in this index definition
index posts_delta : posts
{
    path            = c:/Sphinx/data/posts_delta
    source          = posts_delta
}


##################### COMMENTS ##################################################
source comments
{
	# data source type. mandatory, no default value
	# known types are 'mysql', 'pgsql', 'mssql', 'xmlpipe', 'xmlpipe2'
	type					= mysql
	sql_host                                = localhost
	sql_user				= root
	sql_pass				=
	sql_db					= ins
	sql_port				= 3306	# optional, default is 3306

    sql_query_pre = SET NAMES utf8
	#link_id = comment_link_id
	sql_query= SELECT id, UNIX_TIMESTAMP(date_pub) AS date, user_id as user, rating, content FROM su_comments
	

    sql_attr_uint           = user
    sql_attr_bigint         = rating
    sql_attr_timestamp      = date
	sql_ranged_throttle = 0
}


source comments_delta : comments
{
    sql_query_pre   =
    sql_query_pre = SET NAMES utf8
	sql_query  = SELECT comment_id as id, UNIX_TIMESTAMP(date_pub) AS date, user_id as user, rating, content FROM comments WHERE date_pub > date_sub(now(), interval 1 day)
}

index comments {
	source = comments
	path = c:/Sphinx/data/comments
	mlock			= 0
	morphology	= libstemmer_russian
	min_word_len = 2
	min_stemming_len = 5
	min_prefix_len	= 0
	min_infix_len		= 0
	html_strip				= 1

    charset_table = 0..9, A..Z->a..z, U+23, a..z, U+410..U+42F->U+430..U+44F, U+430..U+44F,U+C5->U+E5, \
            U+E5, U+C4->U+E4, U+E4, U+D6->U+F6, U+F6, U+16B, U+0c1->a, U+0c4->a, U+0c9->e, U+0cd->i, \
            U+0d3->o, U+0d4->o, U+0da->u, U+0dd->y, U+0e1->a, U+0e4->a, U+0e9->e, U+0ed->i, U+0f3->o, \
            U+0f4->o, U+0fa->u, U+0fd->y, U+104->U+105, U+105, U+106->U+107, U+10c->c, U+10d->c, \
            U+10e->d, U+10f->d, U+116->U+117, U+117, U+118->U+119, U+11a->e, U+11b->e, U+12E->U+12F, \
            U+12F, U+139->l, U+13a->l, U+13d->l, U+13e->l, U+141->U+142, U+142, U+143->U+144, \
            U+144,U+147->n, U+148->n, U+154->r, U+155->r, U+158->r, U+159->r, U+15A->U+15B, U+15B, \
            U+160->s, U+160->U+161, U+161->s, U+164->t, U+165->t, U+16A->U+16B, U+16B, U+16e->u, \
            U+16f->u, U+172->U+173, U+173, U+179->U+17A, U+17A, U+17B->U+17C, U+17C, U+17d->z, \
            U+17e->z, U+DC->U+FC, U+DF, U+FC, \
            U+0D1->U+0F1, U+0F1, \
            U+C7->U+E7, U+E7, U+C0->a, U+E0->a, U+C8->e, U+E8->e, U+CF->i, U+EF->i, U+D2->o, U+F2->o


	stopwords = /usr/local/etc/sphinx.stopwords
	wordforms = /usr/local/etc/sphinx.wordforms
	# http://www.utf8-chartable.de/
	ignore_chars = U+AD, U+5F 
}

# all the parameters are copied from the parent index,
# and may then be overridden in this index definition
index comments_delta : comments
{
    path            = c:/Sphinx/data/comments_delta
    source          = comments_delta
}





#############################################################################
## indexer settings
#############################################################################

indexer
{
	# memory limit, in bytes, kiloytes (16384K) or megabytes (256M)
	# optional, default is 32M, max is 2047M, recommended is 256M to 1024M
	mem_limit			= 512M

	# maximum IO calls per second (for I/O throttling)
	# optional, default is 0 (unlimited)
	#
	# max_iops			= 40


	# maximum IO call size, bytes (for I/O throttling)
	# optional, default is 0 (unlimited)
	#
	# max_iosize		= 1048576
}

#############################################################################
## searchd settings
#############################################################################

searchd
{
	# hostname, port, or hostname:port, or /unix/socket/path to listen on
	# multi-value, multiple listen points are allowed
	# optional, default is 0.0.0.0:3312 (listen on all interfaces, port 3312)
	#
	# listen				= 127.0.0.1
	# listen				= 192.168.0.1:3312
	# listen				= 3312
	# listen				= /var/run/searchd.sock
	listen				        = 9312
	listen = 9306:mysql41


	# log file, searchd run info is logged here
	# optional, default is 'searchd.log'
	log					= /var/log/searchd.log

	# query log file, all search queries are logged here
	# optional, default is empty (do not log queries)
	#query_log			= /var/log/query.log

	# client read timeout, seconds
	# optional, default is 5
	read_timeout		= 5

	# request timeout, seconds
	# optional, default is 5 minutes
	client_timeout		= 30

	# maximum amount of children to fork (concurrent searches to run)
	# optional, default is 0 (unlimited)
	max_children		= 10
	workers			= threads
	# workers		= prefork

	# PID file, searchd process ID file name
	# mandatory
	pid_file			= /var/run/searchd.pid

	# seamless rotate, prevents rotate stalls if precaching huge datasets
	# optional, default is 1
	seamless_rotate		= 1

	# whether to forcibly preopen all indexes on startup
	# optional, default is 0 (do not preopen)
	preopen_indexes		= 1

	# whether to unlink .old index copies on succesful rotation.
	# optional, default is 1 (do unlink)
	unlink_old			= 1

	# attribute updates periodic flush timeout, seconds
	# updates will be automatically dumped to disk this frequently
	# optional, default is 0 (disable periodic flush)
	#
	# attr_flush_period	= 900


	# instance-wide ondisk_dict defaults (per-index value take precedence)
	# optional, default is 0 (precache all dictionaries in RAM)
	#
	# ondisk_dict_default	= 1

    # max allowed network packet size
	# limits both query packets from clients, and responses from agents
	# optional, default size is 8M
	max_packet_size		= 8M

	# crash log path
	# searchd will (try to) log crashed query to 'crash_log_path.PID' file
	# optional, default is empty (do not create crash logs)
	#
	# crash_log_path		= /var/log/crash


	# max allowed per-query filter count
	# optional, default is 256
	max_filters			= 256

	# max allowed per-filter values count
	# optional, default is 4096
	max_filter_values	= 4096
}

# --eof--
